---
title: "Keeping hands with the wrong lands"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{dont-keep-medicore-hands}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(tidyverse)
library(scales)
library(cowplot)
library(gganimate)
library(mtggplot)
```

A classic problem is should you keep a hand that has important spells, but not
the right lands to cast them. Limited is my typical non-causual format, so 
we'll start by calculating the probabilites for 40 card decks.

```{r}
create_hits_distibution_multi_turns <- function(land_count){
  tibble(hits = 1:land_count, turn = list(3:8)) %>% 
    unnest() %>% 
    mutate(prob = dhyper(x = hits, 
                         m = land_count, 
                         # non-snow cards
                         # assume on the draw
                         n = 34 - turn - land_count, 
                         k = turn),
           possible_hits = land_count
    ) %>% 
    # arrange() shouldn't be needed, but just in ase
    arrange(turn) %>% 
    group_by(turn) %>% 
    mutate(prob_of_at_least_one_hit = cumsum(prob)) %>% 
    ungroup()
}

```

```{r create_limited_data}
limited_data <- map_dfr(5:12, create_hits_distibution_multi_turns)
```

```{r limited_gif}
limited_gif <-  ggplot(limited_data, 
                       aes(turn,  prob_of_at_least_one_hit)) + 
  geom_area(fill = "white") +
  transition_states(hits, transition_length = 1, state_length = 2) +
  theme_cowplot() +
  scale_x_continuous(breaks = pretty_breaks(n = 6)) +
  scale_y_continuous(labels = percent) + 
  theme(panel.background = element_rect(fill = 'black')) +
  labs(y = "Probability you find the land you need...", 
       x = "... by turn X (on the play).",
       title = "How many hits can you expect from Glacial Revelation?",
       subtitle = "On-color lands in your Limited deck:{next_state}",
       caption = "Created by Karl Hailperin (@khailper)")

limited_gif
```

